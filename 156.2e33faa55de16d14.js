"use strict";(self.webpackChunk_modelnow_proto=self.webpackChunk_modelnow_proto||[]).push([[156],{2156:(j,d,a)=>{a.r(d),a.d(d,{AppLocationPage:()=>W});var f=a(7800),p=a(1368),I=a(3364),C=a(5657),E=a(800),g=a(6684),R=a(3992),u=a(3616),m=a(7368),O=a(2700),y=a(3120),P=a(4704),h=a(4680),D=a(3412),v=a(5500),L=a(8108),_=a(8372),A=a(4804),t=a(4496),M=a(9592),k=a(7468);const G=["searchInput"];function $(o,l){1&o&&t.wR5(0,"span",11)}function T(o,l){if(1&o){const e=t.KQA();t.SAx(0),t.I0R(1,"p",12),t.OEk(2),t.C$Y(),t.I0R(3,"button",13),t.qCj("click",function(n){t.usT(e);const c=t.GaO();return t.CGJ(c._onLocationConfirmClick(n,c.location))}),t.OEk(4,"Confirmer la localisation"),t.C$Y(),t.I0R(5,"button",14),t.qCj("click",function(n){t.usT(e);const c=t.GaO();return t.CGJ(c._onLocationChangeClick(n))}),t.OEk(6,"Changer"),t.C$Y(),t.k70()}if(2&o){const e=t.GaO();t.yG2(2),t.oRS(" ",e.location.properties.label," ")}}function K(o,l){1&o&&t.wR5(0,"span",25)}function U(o,l){if(1&o){const e=t.KQA();t.I0R(0,"li",20)(1,"button",21),t.qCj("click",function(n){const s=t.usT(e).$implicit,r=t.GaO(3);return t.CGJ(r._onLocationClick(n,s))}),t.yuY(2,K,1,0,"span",22),t.I0R(3,"span",23),t.OEk(4),t.C$Y(),t.OEk(5),t.I0R(6,"span",24),t.OEk(7),t.C$Y()()()}if(2&o){const e=l.$implicit,i=t.GaO(3);t.yG2(2),t.E7m("ngIf",e.properties.id===(null==i.currentLocation||null==i.currentLocation.properties?null:i.currentLocation.properties.id)),t.yG2(2),t.oRS(" ",e.properties.name," "),t.yG2(),t.oRS(" "," "," "),t.yG2(2),t.MjK(" ",e.properties.postcode,""," ","",e.properties.city," ")}}function b(o,l){if(1&o&&(t.I0R(0,"ul",18),t.yuY(1,U,8,6,"li",19),t.C$Y()),2&o){const e=t.GaO(2);t.yG2(),t.E7m("ngForOf",e.searchResult.features)}}function Y(o,l){1&o&&(t.I0R(0,"ul",26)(1,"li",20)(2,"div",27)(3,"span",23),t.wR5(4,"span",28),t.C$Y(),t.OEk(5),t.I0R(6,"span",24),t.wR5(7,"span",29),t.C$Y()()(),t.I0R(8,"li",20)(9,"div",27)(10,"span",23),t.wR5(11,"span",28),t.C$Y(),t.OEk(12),t.I0R(13,"span",24),t.wR5(14,"span",29),t.C$Y()()(),t.I0R(15,"li",20)(16,"div",27)(17,"span",23),t.wR5(18,"span",28),t.C$Y(),t.OEk(19),t.I0R(20,"span",24),t.wR5(21,"span",29),t.C$Y()()(),t.I0R(22,"li",20)(23,"div",27)(24,"span",23),t.wR5(25,"span",28),t.C$Y(),t.OEk(26),t.I0R(27,"span",24),t.wR5(28,"span",29),t.C$Y()()()()),2&o&&(t.yG2(5),t.oRS(" "," "," "),t.yG2(7),t.oRS(" "," "," "),t.yG2(7),t.oRS(" "," "," "),t.yG2(7),t.oRS(" "," "," "))}function B(o,l){if(1&o&&(t.I0R(0,"div",15),t.yuY(1,b,2,1,"ul",16)(2,Y,29,4,"ng-template",null,17,t.gJz),t.C$Y()),2&o){const e=t.Gew(3),i=t.GaO();t.yG2(),t.E7m("ngIf",i.searchResult&&!i.searchProgressing)("ngIfElse",e)}}function F(o,l){if(1&o&&(t.I0R(0,"l-map",30),t.wR5(1,"l-tile-layer")(2,"l-control-scale")(3,"l-control-zoom")(4,"l-marker",31),t.C$Y()),2&o){const e=t.GaO();t.E7m("l-center",e.locationCoordinates),t.e48("aria-label","Carte centr\xe9e sur "+e.location.properties.label),t.yG2(4),t.E7m("l-latlng",e.locationCoordinates)("l-alt",e.location.properties.label)}}let W=(()=>{class o{get backUrl(){return this.routerFacade.backUrl({steps:1,defaultUrl:"/"})}get currentLocation(){return this.locationFacade.current()}get locationCoordinates(){return this.location&&(0,v.i)(this.location)}get searchInputFocused(){return this.doc.activeElement===this.searchInputRef.nativeElement}get searchInputValue(){return this.searchInputRef?.nativeElement?.value||""}get searchProgressing(){return this.locationFacade.progressing()}get searchQuery(){return this.locationFacade.query()}get searchResult(){return this.locationFacade.result()}constructor(e,i,n,c){this.changeDetectorRef=e,this.doc=i,this.routerFacade=n,this.locationFacade=c,this.location=null,this.destroyed$=new C.E}ngOnInit(){const{nativeElement:e}=this.searchInputRef,c=(0,E.w)(e,"keydown").pipe((0,g.I)(({keyCode:r})=>r===f.wJ)).pipe((0,R.U)(1));(0,E.w)(e,"input").pipe((0,u.a)(this.destroyed$),(0,m.G)(()=>{const r=this.searchInputValue;return r?(0,y.k)(800).pipe((0,u.a)(this.destroyed$),(0,u.a)(c),(0,P.k)(()=>r)):(0,O.of)("")}),(0,h.o)(0)).subscribe(r=>{this.locationFacade.search({query:r})}),(0,D.U)(this.locationFacade.state$,this.routerFacade.history$).pipe((0,u.a)(this.destroyed$),(0,h.o)(0)).subscribe(()=>{this.changeDetectorRef.markForCheck()}),this.locationFacade.progressing$.pipe((0,u.a)(this.destroyed$),(0,g.I)(r=>!!r&&r!==this.searchInputValue),(0,h.o)(0)).subscribe(r=>{this.searchInputRef.nativeElement.value=r}),this.searchQuery!==this.searchInputValue&&(this.searchInputRef.nativeElement.value=this.searchQuery)}changeLocation(){this.location&&(this.location=null,this.changeDetectorRef.markForCheck())}geolocate(){this.locationFacade.geolocate()}setLocation(e){e!==this.location&&(this.location=e,this.changeDetectorRef.markForCheck())}_onGeolocateClick(e){e.preventDefault(),this.geolocate()}_onLocationClick(e,i){e.preventDefault(),this.setLocation(i)}_onLocationChangeClick(e){e.preventDefault(),this.changeLocation()}_onLocationConfirmClick(e,i){e.preventDefault(),this.locationFacade.confirm({feat:i}),this.routerFacade.goBackUrl({steps:1,defaultUrl:"/"})}_onSearchInputKeyDownEnter(e){e.preventDefault(),this.locationFacade.search({query:this.searchInputValue})}static#t=this.\u0275fac=function(i){return new(i||o)(t.GI1(t.kD9),t.GI1(p.Ud),t.GI1(M.A),t.GI1(k.u))};static#e=this.\u0275cmp=t.In1({type:o,selectors:[["app-location-page"]],viewQuery:function(i,n){if(1&i&&t.CC$(G,7),2&i){let c;t.wto(c=t.Gqi())&&(n.searchInputRef=c.first)}},hostVars:2,hostBindings:function(i,n){2&i&&t.eAK("app-location-page",!0)},standalone:!0,features:[t.UHJ],decls:14,vars:15,consts:[[1,"ui-heading-6"],["aria-hidden","true","ui-icon","clover:location",4,"ngIf"],["aria-label","Retour","ui-icon","clover:back","ui-ripple","","ui-ripple-centered","","ui-ripple-unbounded","",1,"back-button","ui-button",3,"routerLink"],[4,"ngIf"],[1,"search-block"],[1,"search-form"],["type","search","autocomplete","off","placeholder","Ajouter une localisation",1,"location-search-input","ui-input","ui-input--has-icon",3,"keydown.enter"],["searchInput",""],["type","button","title","Autour de moi","ui-icon","clover:location","ui-ripple","","ui-ripple-centered","",1,"geolocate-button",3,"click"],["class","search-list",4,"ngIf"],["class","location-preview",3,"l-center",4,"ngIf"],["aria-hidden","true","ui-icon","clover:location"],[1,"ui-subtitle-1"],["type","button","ui-ripple","",1,"location-confirm-button","ui-button","ui-button--primary","ui-button--md",3,"click"],["type","button","ui-ripple","",1,"location-change-button","ui-button",3,"click"],[1,"search-list"],["class","ui-grid-of-items",4,"ngIf","ngIfElse"],["searchProgressingBlock",""],[1,"ui-grid-of-items"],["class","ui-grid-of-items__cell",4,"ngFor","ngForOf"],[1,"ui-grid-of-items__cell"],["type","button","ui-ripple","",1,"ui-item",3,"click"],["aria-hidden","true","class","ui-item__image--s","ui-icon","ionicon:location",4,"ngIf"],[1,"ui-item__label"],[1,"ui-item__sublabel"],["aria-hidden","true","ui-icon","ionicon:location",1,"ui-item__image--s"],["aria-hidden","true",1,"ui-grid-of-items","ui-placeholder--glow"],[1,"ui-item"],[1,"ui-placeholder",2,"width","135px"],[1,"ui-placeholder",2,"width","64px"],[1,"location-preview",3,"l-center"],["l-interactive","false","l-keyboard","false",3,"l-latlng","l-alt"]],template:function(i,n){1&i&&(t.I0R(0,"header")(1,"h2",0),t.yuY(2,$,1,0,"span",1),t.I0R(3,"span"),t.OEk(4),t.C$Y()(),t.wR5(5,"a",2),t.yuY(6,T,7,1,"ng-container",3),t.C$Y(),t.I0R(7,"section",4)(8,"div",5)(9,"input",6,7),t.qCj("keydown.enter",function(s){return n._onSearchInputKeyDownEnter(s)}),t.C$Y(),t.I0R(11,"button",8),t.qCj("click",function(s){return n._onGeolocateClick(s)}),t.C$Y()(),t.yuY(12,B,4,2,"div",9),t.C$Y(),t.yuY(13,F,5,4,"l-map",10)),2&i&&(t.eAK("location-header--on-preview",!!n.location),t.yG2(2),t.E7m("ngIf",!!n.location),t.yG2(2),t.cNF(n.location?n.location.properties.city:"Votre position"),t.yG2(),t.eAK("back-button--at-end",!!n.location),t.E7m("routerLink",n.backUrl),t.yG2(),t.E7m("ngIf",!!n.location),t.yG2(),t.m4B("display",n.location?"none":"block"),t.e48("aria-hidden",n.location?"true":null),t.yG2(2),t.e48("tabindex",n.location?-1:null),t.yG2(2),t.e48("tabindex",n.location?-1:null),t.yG2(),t.E7m("ngIf",n.searchResult||n.searchProgressing),t.yG2(),t.E7m("ngIf",n.location))},dependencies:[p.MD,p.ay,p.u_,I.ER,_.Ir,_.__,_.KW,_.gA,_.Kc,L.W,A.i],encapsulation:2,changeDetection:0})}return o})()}}]);