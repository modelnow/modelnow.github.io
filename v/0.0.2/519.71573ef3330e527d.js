"use strict";(self.webpackChunk_modelnow_proto=self.webpackChunk_modelnow_proto||[]).push([[519],{2519:(at,v,o)=>{o.r(v),o.d(v,{AppLocationPage:()=>it});var C=o(6028),h=o(6814),y=o(4101),f=o(8645),Z=o(2438),k=o(2181),_=o(8180),u=o(9773),x=o(4664),A=o(2096),U=o(9080),b=o(7398),m=o(3620),P=o(3019),F=o(7667),I=o(7582),R=o(4366),$=o(5592),O=o(7453),D=o(4829),E=o(9940),M=o(8251),J=o(7400),Q=o(2714),j=o(4225),N=o(6404),Y=o(1137),t=o(5879);class p{get center(){return this._center}set center(n){"string"==typeof n&&n.length&&(n=n.split(",").map(e=>+e).slice(0,2)),Array.isArray(n)&&n.length>1&&(n[0]!==this._center[0]||n[1]!==this._center[1])&&(this._center=n,this._map?.setView(n),this.action$.next("refreshCenteredMarker"))}get marked(){return this._marked}set marked(n){n!==this._marked&&(this._marked=n,this.action$.next("refreshCenteredMarker"))}get zoom(){return this._zoom}set zoom(n){n!==this._zoom&&(this._zoom=n,this._map?.setZoom(n))}constructor(n){this.elementRef=n,this._center=[48.854213,2.356361],this._marked=!1,this._zoom=15,this._map=null,this._marker=null,this.leaftletPromise=null,this.action$=new f.x,this.destroyed$=new f.x}ngOnInit(){this.action$.pipe((0,u.R)(this.destroyed$),(0,x.w)(n=>"createMap"===n||this._map?(this.leaftletPromise||(this.leaftletPromise=o.e(433).then(o.t.bind(o,8433,23))),function z(...a){const n=(0,E.jO)(a),{args:e,keys:i}=(0,O.D)(a),c=new $.y(r=>{const{length:l}=e;if(!l)return void r.complete();const s=new Array(l);let L=l,T=l;for(let d=0;d<l;d++){let g=!1;(0,D.Xf)(e[d]).subscribe((0,M.x)(r,ot=>{g||(g=!0,T--),s[d]=ot},()=>L--,void 0,()=>{(!L||!g)&&(T||r.next(i?(0,Q.n)(i,s):s),r.complete())}))}});return n?c.pipe((0,J.Z)(n)):c}({l:this.leaftletPromise,action:(0,A.of)(n)})):R.C)).subscribe(({l:n,action:e})=>{"createMap"===e?this._createMap(n):"refreshCenteredMarker"===e?this._refreshCenteredMarker(n):console.error(`UiLeafletDirective::ngOnInit: unknown action ${e}`)})}ngAfterViewInit(){(0,j.J)()&&this.action$.next("createMap")}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete(),this._destroyMap()}_createMap(n){return this._map||(this._map=n.map(this.elementRef.nativeElement,{center:this._center,zoom:this._zoom}),this._map.attributionControl.setPrefix(""),n.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{attribution:"",maxZoom:20,subdomains:"abcd"}).addTo(this._map),this._refreshCenteredMarker(n)),this._map}_destroyMap(){this._map&&(this._map.remove(),this._map=null)}_refreshCenteredMarker(n){this._marked?(this._marker||(this._marker=n.marker(this._center)),this._map&&!this._map.hasLayer(this._marker)&&this._map.addLayer(this._marker)):this._marker&&(this._map?.removeLayer(this._marker),this._marker.remove(),this._marker=null)}}p.\u0275fac=function(n){return new(n||p)(t.Y36(t.SBq))},p.\u0275dir=t.lG2({type:p,selectors:[["","ui-leaflet",""]],hostAttrs:[1,"ui-leaflet"],inputs:{center:["ui-leaflet","center"],marked:["ui-leaflet-marked","marked"],zoom:["ui-leaflet-zoom","zoom"]},exportAs:["uiLeaflet"],standalone:!0}),(0,I.gn)([(0,Y.x)()],p.prototype,"marked",null),(0,I.gn)([(0,N.Y)()],p.prototype,"zoom",null);var K=o(372),w=o(7213),V=o(2655);const B=["searchInput"];function G(a,n){1&a&&t._UZ(0,"span",12)}function H(a,n){if(1&a&&t._UZ(0,"a",13),2&a){const e=t.oxw();t.Q6J("routerLink",e.backUrl)}}function S(a,n){if(1&a){const e=t.EpF();t.ynx(0),t.TgZ(1,"p",14),t._uU(2),t.qZA(),t.TgZ(3,"button",15),t.NdJ("click",function(c){t.CHM(e);const r=t.oxw();return t.KtG(r._onLocationConfirmClick(c,r.location))}),t._uU(4,"Confirmer la localisation"),t.qZA(),t.TgZ(5,"button",16),t.NdJ("click",function(c){t.CHM(e);const r=t.oxw();return t.KtG(r._onLocationChangeClick(c))}),t._uU(6,"Changer"),t.qZA(),t.BQk()}if(2&a){const e=t.oxw();t.xp6(2),t.hij(" ",e.location.properties.label," ")}}function X(a,n){1&a&&t._UZ(0,"span",27)}function W(a,n){if(1&a){const e=t.EpF();t.TgZ(0,"li",22)(1,"button",23),t.NdJ("click",function(c){const l=t.CHM(e).$implicit,s=t.oxw(3);return t.KtG(s._onLocationClick(c,l))}),t.YNc(2,X,1,0,"span",24),t.TgZ(3,"span",25),t._uU(4),t.qZA(),t._uU(5),t.TgZ(6,"span",26),t._uU(7),t.qZA()()()}if(2&a){const e=n.$implicit,i=t.oxw(3);t.xp6(2),t.Q6J("ngIf",e.properties.id===(null==i.currentLocation||null==i.currentLocation.properties?null:i.currentLocation.properties.id)),t.xp6(2),t.hij(" ",e.properties.name," "),t.xp6(1),t.hij(" "," "," "),t.xp6(2),t.lnq(" ",e.properties.postcode,""," ","",e.properties.city," ")}}function q(a,n){if(1&a&&(t.TgZ(0,"ul",20),t.YNc(1,W,8,6,"li",21),t.qZA()),2&a){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.searchResult.features)}}function tt(a,n){1&a&&(t.TgZ(0,"ul",28)(1,"li",22)(2,"div",29)(3,"span",25),t._UZ(4,"span",30),t.qZA(),t._uU(5),t.TgZ(6,"span",26),t._UZ(7,"span",31),t.qZA()()(),t.TgZ(8,"li",22)(9,"div",29)(10,"span",25),t._UZ(11,"span",30),t.qZA(),t._uU(12),t.TgZ(13,"span",26),t._UZ(14,"span",31),t.qZA()()(),t.TgZ(15,"li",22)(16,"div",29)(17,"span",25),t._UZ(18,"span",30),t.qZA(),t._uU(19),t.TgZ(20,"span",26),t._UZ(21,"span",31),t.qZA()()(),t.TgZ(22,"li",22)(23,"div",29)(24,"span",25),t._UZ(25,"span",30),t.qZA(),t._uU(26),t.TgZ(27,"span",26),t._UZ(28,"span",31),t.qZA()()()()),2&a&&(t.xp6(5),t.hij(" "," "," "),t.xp6(7),t.hij(" "," "," "),t.xp6(7),t.hij(" "," "," "),t.xp6(7),t.hij(" "," "," "))}function et(a,n){if(1&a&&(t.TgZ(0,"div",17),t.YNc(1,q,2,1,"ul",18),t.YNc(2,tt,29,4,"ng-template",null,19,t.W1O),t.qZA()),2&a){const e=t.MAs(3),i=t.oxw();t.xp6(1),t.Q6J("ngIf",i.searchResult&&!i.searchProgressing)("ngIfElse",e)}}function nt(a,n){if(1&a&&t._UZ(0,"section",32),2&a){const e=t.oxw();t.Q6J("ui-leaflet",e.locationCoordinates)("ui-leaflet-marked",!0),t.uIk("aria-label","Carte centr\xe9e sur "+e.location.properties.label)}}let it=(()=>{class a{get backUrl(){return this.routerFacade.backUrl()}get currentLocation(){return this.locationFacade.current()}get locationCoordinates(){return this.location&&[this.location.geometry.coordinates[1],this.location.geometry.coordinates[0]]}get searchInputFocused(){return this.doc.activeElement===this.searchInputRef.nativeElement}get searchInputValue(){return this.searchInputRef?.nativeElement?.value||""}get searchProgressing(){return this.locationFacade.progressing()}get searchQuery(){return this.locationFacade.query()}get searchResult(){return this.locationFacade.result()}constructor(e,i,c,r){this.changeDetectorRef=e,this.doc=i,this.routerFacade=c,this.locationFacade=r,this.location=this.locationFacade.current(),this.destroyed$=new f.x}ngOnInit(){const{nativeElement:e}=this.searchInputRef,r=(0,Z.R)(e,"keydown").pipe((0,k.h)(({keyCode:s})=>s===C.K5)).pipe((0,_.q)(1));(0,Z.R)(e,"input").pipe((0,u.R)(this.destroyed$),(0,x.w)(()=>{const s=this.searchInputValue;return s?(0,U.H)(800).pipe((0,u.R)(this.destroyed$),(0,u.R)(r),(0,b.U)(()=>s)):(0,A.of)("")}),(0,m.b)(0)).subscribe(s=>{this.locationFacade.search({query:s})}),(0,P.T)(this.locationFacade.state$,this.routerFacade.history$).pipe((0,u.R)(this.destroyed$),(0,m.b)(0)).subscribe(()=>{this.changeDetectorRef.markForCheck()}),this.locationFacade.progressing$.pipe((0,u.R)(this.destroyed$),(0,k.h)(s=>!!s&&s!==this.searchInputValue),(0,m.b)(0)).subscribe(s=>{this.searchInputRef.nativeElement.value=s}),this.searchQuery!==this.searchInputValue&&(this.searchInputRef.nativeElement.value=this.searchQuery)}changeLocation(){this.location&&(this.location=null,this.changeDetectorRef.markForCheck())}geolocate(){this.locationFacade.geolocate()}setLocation(e){e!==this.location&&(this.location=e,this.changeDetectorRef.markForCheck())}_onGeolocateClick(e){e.preventDefault(),this.geolocate()}_onLocationClick(e,i){e.preventDefault(),this.setLocation(i)}_onLocationChangeClick(e){e.preventDefault(),this.changeLocation()}_onLocationConfirmClick(e,i){e.preventDefault(),this.locationFacade.confirm({feat:i}),this.routerFacade.goBackUrl()}_onSearchInputKeyDownEnter(e){e.preventDefault(),this.locationFacade.search({query:this.searchInputValue})}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(t.sBO),t.Y36(h.K0),t.Y36(w.f),t.Y36(V.k))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-location-page"]],viewQuery:function(e,i){if(1&e&&t.Gf(B,7),2&e){let c;t.iGM(c=t.CRH())&&(i.searchInputRef=c.first)}},hostVars:2,hostBindings:function(e,i){2&e&&t.ekj("app-location-page",!0)},standalone:!0,features:[t.jDz],decls:16,vars:13,consts:[[1,"ui-sr-only"],[1,"ui-heading-6"],["aria-hidden","true","ui-icon","clover:location",4,"ngIf"],["aria-label","Retour","class","back-button ui-button","ui-icon","clover:close","ui-ripple","","ui-ripple-centered","",3,"routerLink",4,"ngIf"],[4,"ngIf"],[1,"search-block"],[1,"search-form"],["type","search","placeholder","Ajouter une localisation",1,"location-search-input","ui-input","ui-input--has-icon",3,"keydown.enter"],["searchInput",""],["type","button","aria-label","Me g\xe9olocalisation","ui-icon","clover:location","ui-ripple","","ui-ripple-centered","",1,"geolocate-button",3,"click"],["class","search-list",4,"ngIf"],["class","location-preview",3,"ui-leaflet","ui-leaflet-marked",4,"ngIf"],["aria-hidden","true","ui-icon","clover:location"],["aria-label","Retour","ui-icon","clover:close","ui-ripple","","ui-ripple-centered","",1,"back-button","ui-button",3,"routerLink"],[1,"ui-subtitle-1"],["type","button","ui-ripple","",1,"location-confirm-button","ui-button","ui-button--primary","ui-button--md",3,"click"],["type","button","ui-ripple","",1,"location-change-button","ui-button",3,"click"],[1,"search-list"],["class","ui-grid-of-items",4,"ngIf","ngIfElse"],["searchProgressingBlock",""],[1,"ui-grid-of-items"],["class","ui-grid-of-items__cell",4,"ngFor","ngForOf"],[1,"ui-grid-of-items__cell"],["type","button","ui-ripple","",1,"ui-item",3,"click"],["aria-hidden","true","class","ui-item__image--s","ui-icon","ionicon:location",4,"ngIf"],[1,"ui-item__label"],[1,"ui-item__sublabel"],["aria-hidden","true","ui-icon","ionicon:location",1,"ui-item__image--s"],["aria-hidden","true",1,"ui-grid-of-items","ui-placeholder--glow"],[1,"ui-item"],[1,"ui-placeholder",2,"width","135px"],[1,"ui-placeholder",2,"width","64px"],[1,"location-preview",3,"ui-leaflet","ui-leaflet-marked"]],template:function(e,i){1&e&&(t.TgZ(0,"header")(1,"h1",0),t._uU(2," Beemod : votre position "),t.qZA(),t.TgZ(3,"h2",1),t.YNc(4,G,1,0,"span",2),t.TgZ(5,"span"),t._uU(6),t.qZA()(),t.YNc(7,H,1,1,"a",3),t.YNc(8,S,7,1,"ng-container",4),t.qZA(),t.TgZ(9,"section",5)(10,"div",6)(11,"input",7,8),t.NdJ("keydown.enter",function(r){return i._onSearchInputKeyDownEnter(r)}),t.qZA(),t.TgZ(13,"button",9),t.NdJ("click",function(r){return i._onGeolocateClick(r)}),t.qZA()(),t.YNc(14,et,4,2,"div",10),t.qZA(),t.YNc(15,nt,1,3,"section",11)),2&e&&(t.ekj("location-header--on-preview",!!i.location),t.xp6(4),t.Q6J("ngIf",!!i.location),t.xp6(2),t.Oqu(i.location?i.location.properties.city:"Votre position"),t.xp6(1),t.Q6J("ngIf",!i.location),t.xp6(1),t.Q6J("ngIf",!!i.location),t.xp6(1),t.Udp("display",i.location?"none":"block"),t.uIk("aria-hidden",i.location?"true":null),t.xp6(2),t.uIk("tabindex",i.location?-1:null),t.xp6(2),t.uIk("tabindex",i.location?-1:null),t.xp6(1),t.Q6J("ngIf",i.searchResult||i.searchProgressing),t.xp6(1),t.Q6J("ngIf",i.location))},dependencies:[h.ez,h.sg,h.O5,y.Bz,y.rH,F.l,p,K.N],encapsulation:2,changeDetection:0}),a})()}}]);