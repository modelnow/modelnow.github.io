"use strict";(self.webpackChunk_modelnow_proto=self.webpackChunk_modelnow_proto||[]).push([[332],{7332:(Q,h,i)=>{i.r(h),i.d(h,{AppLocationPage:()=>W});var E=i(6028),p=i(6814),A=i(3573),I=i(8645),g=i(2438),d=i(2181),P=i(8180),s=i(9773),m=i(4664),D=i(2096),v=i(9080),L=i(7398),_=i(3620),O=i(3019),T=i(3899),Z=i(7667),u=i(3940),U=i(5744),t=i(5879),C=i(7213),x=i(2655);const M=["searchInput"];function R(o,a){1&o&&t._UZ(0,"span",11)}function y(o,a){if(1&o){const e=t.EpF();t.ynx(0),t.TgZ(1,"p",12),t._uU(2),t.qZA(),t.TgZ(3,"button",13),t.NdJ("click",function(c){t.CHM(e);const r=t.oxw();return t.KtG(r._onLocationConfirmClick(c,r.location))}),t._uU(4,"Confirmer la localisation"),t.qZA(),t.TgZ(5,"button",14),t.NdJ("click",function(c){t.CHM(e);const r=t.oxw();return t.KtG(r._onLocationChangeClick(c))}),t._uU(6,"Changer"),t.qZA(),t.BQk()}if(2&o){const e=t.oxw();t.xp6(2),t.hij(" ",e.location.properties.label," ")}}function k(o,a){1&o&&t._UZ(0,"span",25)}function b(o,a){if(1&o){const e=t.EpF();t.TgZ(0,"li",20)(1,"button",21),t.NdJ("click",function(c){const f=t.CHM(e).$implicit,l=t.oxw(3);return t.KtG(l._onLocationClick(c,f))}),t.YNc(2,k,1,0,"span",22),t.TgZ(3,"span",23),t._uU(4),t.qZA(),t._uU(5),t.TgZ(6,"span",24),t._uU(7),t.qZA()()()}if(2&o){const e=a.$implicit,n=t.oxw(3);t.xp6(2),t.Q6J("ngIf",e.properties.id===(null==n.currentLocation||null==n.currentLocation.properties?null:n.currentLocation.properties.id)),t.xp6(2),t.hij(" ",e.properties.name," "),t.xp6(1),t.hij(" "," "," "),t.xp6(2),t.lnq(" ",e.properties.postcode,""," ","",e.properties.city," ")}}function K(o,a){if(1&o&&(t.TgZ(0,"ul",18),t.YNc(1,b,8,6,"li",19),t.qZA()),2&o){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.searchResult.features)}}function B(o,a){1&o&&(t.TgZ(0,"ul",26)(1,"li",20)(2,"div",27)(3,"span",23),t._UZ(4,"span",28),t.qZA(),t._uU(5),t.TgZ(6,"span",24),t._UZ(7,"span",29),t.qZA()()(),t.TgZ(8,"li",20)(9,"div",27)(10,"span",23),t._UZ(11,"span",28),t.qZA(),t._uU(12),t.TgZ(13,"span",24),t._UZ(14,"span",29),t.qZA()()(),t.TgZ(15,"li",20)(16,"div",27)(17,"span",23),t._UZ(18,"span",28),t.qZA(),t._uU(19),t.TgZ(20,"span",24),t._UZ(21,"span",29),t.qZA()()(),t.TgZ(22,"li",20)(23,"div",27)(24,"span",23),t._UZ(25,"span",28),t.qZA(),t._uU(26),t.TgZ(27,"span",24),t._UZ(28,"span",29),t.qZA()()()()),2&o&&(t.xp6(5),t.hij(" "," "," "),t.xp6(7),t.hij(" "," "," "),t.xp6(7),t.hij(" "," "," "),t.xp6(7),t.hij(" "," "," "))}function j(o,a){if(1&o&&(t.TgZ(0,"div",15),t.YNc(1,K,2,1,"ul",16),t.YNc(2,B,29,4,"ng-template",null,17,t.W1O),t.qZA()),2&o){const e=t.MAs(3),n=t.oxw();t.xp6(1),t.Q6J("ngIf",n.searchResult&&!n.searchProgressing)("ngIfElse",e)}}function F(o,a){if(1&o&&(t.TgZ(0,"l-map",30),t._UZ(1,"l-tile-layer")(2,"l-control-scale")(3,"l-control-zoom")(4,"l-marker",31),t.qZA()),2&o){const e=t.oxw();t.Q6J("l-center",e.locationCoordinates),t.uIk("aria-label","Carte centr\xe9e sur "+e.location.properties.label),t.xp6(4),t.Q6J("l-latlng",e.locationCoordinates)("l-alt",e.location.properties.label)}}let W=(()=>{class o{get backUrl(){return this.routerFacade.backUrl({steps:1,defaultUrl:"/"})}get currentLocation(){return this.locationFacade.current()}get locationCoordinates(){return this.location&&(0,T.D)(this.location)}get searchInputFocused(){return this.doc.activeElement===this.searchInputRef.nativeElement}get searchInputValue(){return this.searchInputRef?.nativeElement?.value||""}get searchProgressing(){return this.locationFacade.progressing()}get searchQuery(){return this.locationFacade.query()}get searchResult(){return this.locationFacade.result()}constructor(e,n,c,r){this.changeDetectorRef=e,this.doc=n,this.routerFacade=c,this.locationFacade=r,this.location=null,this.destroyed$=new I.x}ngOnInit(){const{nativeElement:e}=this.searchInputRef,r=(0,g.R)(e,"keydown").pipe((0,d.h)(({keyCode:l})=>l===E.K5)).pipe((0,P.q)(1));(0,g.R)(e,"input").pipe((0,s.R)(this.destroyed$),(0,m.w)(()=>{const l=this.searchInputValue;return l?(0,v.H)(800).pipe((0,s.R)(this.destroyed$),(0,s.R)(r),(0,L.U)(()=>l)):(0,D.of)("")}),(0,_.b)(0)).subscribe(l=>{this.locationFacade.search({query:l})}),(0,O.T)(this.locationFacade.state$,this.routerFacade.history$).pipe((0,s.R)(this.destroyed$),(0,_.b)(0)).subscribe(()=>{this.changeDetectorRef.markForCheck()}),this.locationFacade.progressing$.pipe((0,s.R)(this.destroyed$),(0,d.h)(l=>!!l&&l!==this.searchInputValue),(0,_.b)(0)).subscribe(l=>{this.searchInputRef.nativeElement.value=l}),this.searchQuery!==this.searchInputValue&&(this.searchInputRef.nativeElement.value=this.searchQuery)}changeLocation(){this.location&&(this.location=null,this.changeDetectorRef.markForCheck())}geolocate(){this.locationFacade.geolocate()}setLocation(e){e!==this.location&&(this.location=e,this.changeDetectorRef.markForCheck())}_onGeolocateClick(e){e.preventDefault(),this.geolocate()}_onLocationClick(e,n){e.preventDefault(),this.setLocation(n)}_onLocationChangeClick(e){e.preventDefault(),this.changeLocation()}_onLocationConfirmClick(e,n){e.preventDefault(),this.locationFacade.confirm({feat:n}),this.routerFacade.goBackUrl({steps:1,defaultUrl:"/"})}_onSearchInputKeyDownEnter(e){e.preventDefault(),this.locationFacade.search({query:this.searchInputValue})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(t.sBO),t.Y36(p.K0),t.Y36(C.f),t.Y36(x.k))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-location-page"]],viewQuery:function(e,n){if(1&e&&t.Gf(M,7),2&e){let c;t.iGM(c=t.CRH())&&(n.searchInputRef=c.first)}},hostVars:2,hostBindings:function(e,n){2&e&&t.ekj("app-location-page",!0)},standalone:!0,features:[t.jDz],decls:14,vars:15,consts:[[1,"ui-heading-6"],["aria-hidden","true","ui-icon","clover:location",4,"ngIf"],["aria-label","Retour","ui-icon","clover:back","ui-ripple","","ui-ripple-centered","","ui-ripple-unbounded","",1,"back-button","ui-button",3,"routerLink"],[4,"ngIf"],[1,"search-block"],[1,"search-form"],["type","search","autocomplete","off","placeholder","Ajouter une localisation",1,"location-search-input","ui-input","ui-input--has-icon",3,"keydown.enter"],["searchInput",""],["type","button","title","Autour de moi","ui-icon","clover:location","ui-ripple","","ui-ripple-centered","",1,"geolocate-button",3,"click"],["class","search-list",4,"ngIf"],["class","location-preview",3,"l-center",4,"ngIf"],["aria-hidden","true","ui-icon","clover:location"],[1,"ui-subtitle-1"],["type","button","ui-ripple","",1,"location-confirm-button","ui-button","ui-button--primary","ui-button--md",3,"click"],["type","button","ui-ripple","",1,"location-change-button","ui-button",3,"click"],[1,"search-list"],["class","ui-grid-of-items",4,"ngIf","ngIfElse"],["searchProgressingBlock",""],[1,"ui-grid-of-items"],["class","ui-grid-of-items__cell",4,"ngFor","ngForOf"],[1,"ui-grid-of-items__cell"],["type","button","ui-ripple","",1,"ui-item",3,"click"],["aria-hidden","true","class","ui-item__image--s","ui-icon","ionicon:location",4,"ngIf"],[1,"ui-item__label"],[1,"ui-item__sublabel"],["aria-hidden","true","ui-icon","ionicon:location",1,"ui-item__image--s"],["aria-hidden","true",1,"ui-grid-of-items","ui-placeholder--glow"],[1,"ui-item"],[1,"ui-placeholder",2,"width","135px"],[1,"ui-placeholder",2,"width","64px"],[1,"location-preview",3,"l-center"],["l-interactive","false","l-keyboard","false",3,"l-latlng","l-alt"]],template:function(e,n){1&e&&(t.TgZ(0,"header")(1,"h2",0),t.YNc(2,R,1,0,"span",1),t.TgZ(3,"span"),t._uU(4),t.qZA()(),t._UZ(5,"a",2),t.YNc(6,y,7,1,"ng-container",3),t.qZA(),t.TgZ(7,"section",4)(8,"div",5)(9,"input",6,7),t.NdJ("keydown.enter",function(r){return n._onSearchInputKeyDownEnter(r)}),t.qZA(),t.TgZ(11,"button",8),t.NdJ("click",function(r){return n._onGeolocateClick(r)}),t.qZA()(),t.YNc(12,j,4,2,"div",9),t.qZA(),t.YNc(13,F,5,4,"l-map",10)),2&e&&(t.ekj("location-header--on-preview",!!n.location),t.xp6(2),t.Q6J("ngIf",!!n.location),t.xp6(2),t.Oqu(n.location?n.location.properties.city:"Votre position"),t.xp6(1),t.ekj("back-button--at-end",!!n.location),t.Q6J("routerLink",n.backUrl),t.xp6(1),t.Q6J("ngIf",!!n.location),t.xp6(1),t.Udp("display",n.location?"none":"block"),t.uIk("aria-hidden",n.location?"true":null),t.xp6(2),t.uIk("tabindex",n.location?-1:null),t.xp6(2),t.uIk("tabindex",n.location?-1:null),t.xp6(1),t.Q6J("ngIf",n.searchResult||n.searchProgressing),t.xp6(1),t.Q6J("ngIf",n.location))},dependencies:[p.ez,p.sg,p.O5,A.rH,u.A3,u.rj,u.fo,u.pe,u.rb,Z.l,U.N],encapsulation:2,changeDetection:0}),o})()}}]);